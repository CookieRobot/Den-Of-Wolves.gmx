<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>-1</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>application_surface_draw_enable(false);

global.view_midw = surface_get_width(application_surface)/2;
global.view_midh = surface_get_height(application_surface)/2;

global.xOffset = 0;
global.yOffset = 0;

print(instance_number(obj_main))

if(instance_number(obj_main)&gt;1){
    print("Deleted main")
    instance_destroy(self);
    exit;
}
print("Created main")

//if(!instance_exists(obj_depthsorter)){
    //instance_create(x, y, obj_depthsorter);
//}

//create the controller Later we will want a way to load the user's default settings
controller = instance_create(0,0,obj_controller)
controller.persistent = true;

go_a = 0; 
bs_a = 0;

map = ds_grid_create(20, 20);
curArea = 000000;

global.fadeOut = false;
global.fade_alpha = 0;

global.roomDarkness = 0;

global.data = ds_list_create();
global.load = false;

// TWEAK THIS- there seem to be problems with the save system.
if(file_exists("SData.Tien")) global.bufferExists = true;
else global.bufferExists = false;

global.Paused = false;

// Music
global.BGM = noone;

global.BGMVolume = 70;
global.SFXVolume = 100;

// Game Flags (TO BE PLANNED OUT)
flag[0] = false; // Entered first area of the city (Sets map in motion)
flag[1] = false; // First enemy fight (Creates enemies throughout the different rooms)
flag[2] = false; 
flag[3] = false;
flag[4] = false;
flag[5] = false;
flag[6] = false;
flag[7] = false;
flag[8] = false;
// MORE TO BE ADDED

// Stats
global.TotalKills = 0;
global.TotalDeaths = 0;

global.EndTxt = true;

EndQuote[0] = "Congratulations. You have gone through pain unknown to most of your kind. 
               However, you perservered and answered the call to violence. Do not let 
               your guard down; the need for carnage only truly ends at death.";
EndQuote[1] = "Congratulations. For now, you have escaped death without having to spill 
               a single drop of blood. ";
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>with(obj_player){
    p_state = p_states.normal;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// DEBUG ONLY
Debug_KILLKEY = keyboard_check_pressed(ord("K"));
if(instance_exists(obj_player)){
    if(debug_mode){
        if(Debug_KILLKEY){
            with(obj_player){
                p_state = p_states.dead;
            }
        }
    }
} else {
    if(!global.bufferExists)
        if(instance_exists(inst_firstspawn))instance_create(inst_firstspawn.x, inst_firstspawn.y, obj_player);
}

if(global.load){
    if(ContinueGame() = "success"){
        global.load = false;
    }
}

if(instance_exists(obj_player) &amp;&amp; obj_player.p_state == p_states.normal 
    || global.Paused = true){
    canPause = true;
} else {
    canPause = false;
}

if(canPause){
    if(global.Pause_Pressed){ 
        global.Paused = !global.Paused;
    }
}

if(global.Paused){
    instance_deactivate_all(true);
    instance_activate_object(obj_controller);
} else {
    instance_activate_all();
}


global.BGMVolume = clamp(global.BGMVolume, 0, 100);
global.SFXVolume = clamp(global.SFXVolume, 0, 100);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>var msgNum;    
    
if(global.TotalKills &gt; 0) msgNum = 0;
else msgNum = 1;

var msg = EndQuote[msgNum];

message_current = 0;
message_draw = "";
increase = 0.5;
characters = 0;
hold = 0;

message_length = string_length(msg);

if (characters &lt; message_length) {
    hold = keyboard_check(ord("Z"));            
    characters += increase * (1 + hold);
    message_draw = string_copy(msg, 0, characters);
}
        
draw_set_font(f_dialogue)
draw_text(view_xport + 460, view_yport + 480, message_draw);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>window_set_size(800, 600);
display_set_gui_size(view_wport, view_hport);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="77">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>draw_surface_ext(application_surface, global.xOffset, global.yOffset, 1, 1, 0, c_white, 1);

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="76">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(!window_get_fullscreen()){
    var wh = window_get_height();
    var ww = window_get_width();
    
    if(ww &gt;= 800 &amp;&amp; wh &gt;= 600){
        surface_resize(application_surface, 800, 600);
        
        global.xOffset = (ww - 800) / 2;
        global.yOffset = (wh - 600) / 2;
    } else if(ww &gt;= 640 &amp;&amp; wh &gt;= 480){
        surface_resize(application_surface, 640, 480);
        
        global.xOffset = (ww - 640) / 2;
        global.yOffset = (wh - 480) / 2;
    }
} else {
    var wh = display_get_width();
    var ww = display_get_height();
    
    if(ww &gt;= 1680 &amp;&amp; wh &gt;= 1050){
        surface_resize(application_surface, 1600, 900);
        
        global.xOffset = (ww - 1680) / 2;
        global.yOffset = (wh - 1050) / 2;
    } else if(ww &gt;= 1280 &amp;&amp; wh &gt;= 960){
        surface_resize(application_surface, 1280, 960)
        
        global.xOffset = (ww - 1280) / 2;
        global.yOffset = (wh - 960) / 2;
    } else if(ww &gt;= 1024 &amp;&amp; wh &gt;=768){ 
        surface_resize(application_surface, 1024, 768)
        
        global.xOffset = (ww - 1024) / 2;
        global.yOffset = (wh - 768) / 2;
    } else if(ww &gt;= 800 &amp;&amp; wh &gt;= 600){
        surface_resize(application_surface, 800, 600)
        
        global.xOffset = (ww - 800) / 2;
        global.yOffset = (wh - 600) / 2;
    } else if(ww &gt;= 640 &amp;&amp; wh &gt;= 480){
        surface_resize(application_surface, 640, 480)
        
        global.xOffset = (ww - 640) / 2;
        global.yOffset = (wh - 480) / 2;
    }
}

show_debug_message(application_surface);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>display_set_gui_size(view_wport, view_hport);
display_set_gui_maximise(1, 1, global.xOffset, global.yOffset);

if(instance_exists(obj_player)){  
    // Draw Game-Over Screen If Player Is Dead
    if(obj_player.p_state = obj_player.p_states.dead){
        if(bs_a &lt; 1) bs_a+=0.05;
        else if(bs_a = 1) &amp;&amp; (go_a &lt; 1) go_a+=0.05;
        
        var view_midw = surface_get_width(application_surface)/2;
        var view_midh = surface_get_height(application_surface)/2;
        
        draw_set_alpha(bs_a);
        draw_set_color(c_black);
        
        draw_rectangle(view_xport, view_yport, surface_get_width(application_surface), surface_get_height(application_surface), false);
        draw_sprite_ext(spr_gameover, 1, view_midw, view_midh - 160, 3, 3, 0, c_white, go_a);
        
        draw_set_alpha(1);
        draw_set_color(c_white);
    }
}

if(global.fadeOut){
    with(obj_player){
        p_state = p_states.cutscene;
    }
        
    draw_set_color(c_black);
    if(global.fade_alpha &lt; 1){
        global.fade_alpha+=0.2;
    }
    
    draw_set_alpha(global.fade_alpha);
    
    draw_rectangle(view_xport, view_yport, view_wport * window_get_width(), view_hport * window_get_height(), false);
    draw_set_alpha(1);
    draw_set_color(c_white);
    
    alarm[0] = 8;
} else {
    draw_set_color(c_black);
    
    if(global.fade_alpha &gt; 0){
        global.fade_alpha-=0.2;
        draw_set_alpha(global.fade_alpha);   
        draw_rectangle(view_xport, view_yport, view_wport * window_get_width(), view_hport * window_get_height(), false);
    }
    
    draw_set_alpha(1);
    draw_set_color(c_white);
}

// Text at the end of game
if(global.EndTxt){
    event_user(0);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
